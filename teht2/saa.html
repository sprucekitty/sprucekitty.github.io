<html>
<!DOCTYPE html>
<html lang="fi">
<head>
    <title>Kirsin sää haku</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="keywords" content="Digi Intro, HTML, CSS, JSON">
    <meta name="description" content="JSON harjoitussivusto">
    <!--Bootstrapin CSS-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!--bootstrap, bundle-versiossa on mukana myös popper.js-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!--Sitten oma CSS, jolla voi ylikirjoittaa Bootstrapin asetuksia-->
    <link rel="stylesheet" href="style.css"> 
</head>
<body>
<!--Sivun yläosa, jossa navigaatiopalkki-->
<header>
    <nav id="siteNav" class="navbar navbar-expand-sm navbar-light navbar-custom fixed-top">
        <div class="container-fluid justify-content-center">
            <!--Hamburger-menu pienille näytöille-->
            <button class="navbar-toggler custom-toggler" type="button" 
            data-bs-toggle="collapse" data-bs-target="#collapsibleNavbar" 
            aria-controls="collapsibleNavbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div id="collapsibleNavbar" class="collapse navbar-collapse justify-content-center">
                <ul class="navbar-nav text-center">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Etusivu</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="oma-tietue.html">Tehtava 1</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="poke.html">Tehtava 2</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="saa.html">Tehtävä 3</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</header>
<!--Sivun pääsisältö. Container-fluid venyy koko leveyteen, p-5 lisää paddingia.-->  
<main class="container-fluid">
    <section class="container pt-5">
        <h1>Digitekniikat JSON tehtävä 3</h1>
        <p>JSON Säätiedot.</p>
    </section>
    <!--Säätiedot korttimaisella taustalla-->
    <section id="teht3">
        <div class="container p-5 my-3 rounded-4 brand-panel">
            <h2>JSON Säätiedot</h2>
            <!--Tulostetaan JS:llä rakennettu sisältö-->
            <div id="vastaus"></div>
        </div>
    </section>
</main>

<!--Oma JavaScript-->
<script>
    //Haetaan Helsingin ajantasainen säätieto OpenWeatherMapista
    fetch('https://api.openweathermap.org/data/2.5/weather?id=658225&appid=665ecd56dfc08dbb50feb8b8f5034e28&lang=fi&units=metric')
    //Muunnetaan vastaus JS olio muotoon
    .then(function (response) {
        return response.json();
    })
    //Käsitellään muunnettu (eli JSON muotoinen) vastaus ja kutsutaan funktiota haeSaa()ja välitetään sille json-vastaus
    .then(function (responseJson) {
        haeSaa(responseJson);
    })
    //Jos hakemisessa tuli jokin virhe, kirjoitetaan sivulle siitä tieto
    .catch(function (error) {
        document.getElementById("vastaus").innerHTML = "<p>Tietoa ei pystytä hakemaan</p>";
    })
    //Vastauksen käsittely ja rakentaminen yhteen merkkijonoon.
    function haeSaa(data) {
        //Haetaan aika
        var aika = new Date().toLocaleTimeString("fi-FI");
        // Rakennetaan sääikonin URL OpenWeatherMapin ikonikirjastosta.
        var icon = data.weather[0].icon;
        var iconUrl = "https://openweathermap.org/img/wn/" + icon + "@2x.png";
        //kootaan tiedot vastaukseen
        let tiedot = "<h3>Sää Helsingissä</h3>";
        tiedot += "<p><small>Sää klo " + aika + "</small></p>";
        tiedot += "<p><b>Sää:</b><br>" + data.weather[0].description + "</p>";
        tiedot += "<p><b>Lämpötila:</b><br>" + data.main.temp + " °C</p>";
        tiedot += "<p><b>Tuuli:</b><br>" + data.wind.speed + " m/s</p>";
        tiedot += '<p><img src="' + iconUrl + '" alt="' + data.weather[0].description + '"></p>';
        //kirjoitetaan kerralla sivulle
        document.getElementById("vastaus").innerHTML = tiedot;
    }
</script>
</body>
</html>